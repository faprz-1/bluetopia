(self.webpackChunktemplate_web=self.webpackChunktemplate_web||[]).push([[739],{3739:(e,o,t)=>{"use strict";t.r(o),t.d(o,{LoginModule:()=>U});var n=t(1116),r=t(9609),i=t(529),a=t(1041),s=t(7368),c=t(6189),l=t(8937),d=t(1392),g=t(2378),u=t(8118);let p=(()=>{class e{constructor(){}static GetValidatorErrorMessage(e,o){return[{name:"required",label:"Campo requerido"},{name:"invalidRFC",label:"No tiene el formato adecuado"},{name:"invalidEmailAddress",label:"Correo inv\xe1lido"},{name:"invalidPassword",label:"Las contrase\xf1as no coinciden"},{name:"minlength",label:`M\xednimo de Caracteres ${o.requiredLength}`},{name:"maxlength",label:`M\xe1ximo de Caracteres ${o.requiredLength}`},{name:"invalidNumber",label:"Solo n\xfameros enteros, o con decimal"}].find(o=>o.name==e)}static CheckOnlyNumbers(e){return(null==e?void 0:e.value.match(/^[1-9]\d*\.?\d*$/))?0==(null==e?void 0:e.value)?{invalidNumber:!0}:null:{invalidNumber:!0}}static EmailValidator(e){return(null==e?void 0:e.value.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,4})+$/))?null:{invalidEmailAddress:!0}}static RfcValidator(e){return(null==e?void 0:e.value)&&(null==e?void 0:e.value.match(/^([A-Z\xd1&]{3,4}) ?(?:- ?)?(\d{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\d|3[01])) ?(?:- ?)?([A-Z\d]{2})([A\d])$/))?null:{invalidRFC:!0}}}return e.password="",e.confirmPassword="",e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function m(e,o){if(1&e&&(s.TgZ(0,"div",1),s._uU(1),s.qZA()),2&e){const e=s.oxw();s.xp6(1),s.hij(" ",null==e.errorMessage?null:e.errorMessage.label,"\n")}}let h=(()=>{class e{constructor(){}ngOnInit(){}get errorMessage(){var e,o,t,n;for(let r in null===(e=this.control)||void 0===e?void 0:e.errors)if((null===(o=this.control)||void 0===o?void 0:o.errors.hasOwnProperty(r))&&(null===(t=this.control)||void 0===t?void 0:t.touched))return p.GetValidatorErrorMessage(r,null===(n=this.control)||void 0===n?void 0:n.errors[r]);return null}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-control-messages"]],inputs:{control:"control"},decls:1,vars:1,consts:[["class","color-red",4,"ngIf"],[1,"color-red"]],template:function(e,o){1&e&&s.YNc(0,m,2,1,"div",0),2&e&&s.Q6J("ngIf",null!==o.errorMessage)},directives:[n.O5],styles:[""]}),e})();function f(e,o){1&e&&(s.TgZ(0,"div",6),s._uU(1,"JarabeTemplate"),s.qZA())}function v(e,o){1&e&&(s.TgZ(0,"div",6),s._uU(1,"JarabeTemplate STAGING"),s.qZA())}function Z(e,o){1&e&&(s.TgZ(0,"div",6),s._uU(1,"JarabeTemplate LOCAL"),s.qZA())}function b(e,o){1&e&&(s.TgZ(0,"div",23),s._uU(1," Campo obligatorio* "),s.qZA())}function w(e,o){1&e&&(s.TgZ(0,"div",23),s._uU(1," Correo electr\xf3nico no valido"),s.qZA())}function x(e,o){if(1&e&&(s.TgZ(0,"div",21),s.YNc(1,b,2,0,"div",22),s.YNc(2,w,2,0,"div",22),s.qZA()),2&e){s.oxw();const e=s.MAs(12);s.xp6(1),s.Q6J("ngIf",null==e.errors?null:e.errors.required),s.xp6(1),s.Q6J("ngIf",null==e.errors?null:e.errors.pattern)}}function A(e,o){if(1&e&&(s.TgZ(0,"button",24),s._uU(1,"CONTINUAR"),s.qZA()),2&e){s.oxw();const e=s.MAs(7);s.Q6J("disabled",!e.valid)}}function P(e,o){if(1&e){const e=s.EpF();s.TgZ(0,"div"),s.TgZ(1,"h4"),s._uU(2,"Ingrese el PIN"),s.qZA(),s._UZ(3,"br"),s.TgZ(4,"input",25),s.NdJ("ngModelChange",function(o){return s.CHM(e),s.oxw(2).pin=o}),s.qZA(),s._UZ(5,"br"),s._UZ(6,"br"),s.TgZ(7,"button",26),s.NdJ("click",function(){return s.CHM(e),s.oxw(2).TryPIN()}),s._uU(8,"CONTINUAR"),s.qZA(),s._UZ(9,"br"),s._UZ(10,"br"),s.qZA()}if(2&e){const e=s.oxw(2);s.xp6(4),s.Q6J("ngModel",e.pin),s.xp6(3),s.Q6J("disabled",""==e.pin)}}function _(e,o){if(1&e){const e=s.EpF();s.TgZ(0,"div"),s.TgZ(1,"h2",11),s._uU(2,"Ingresa tu nueva contrase\xf1a"),s.qZA(),s.TgZ(3,"input",27),s.NdJ("ngModelChange",function(o){return s.CHM(e),s.oxw(2).newPassword=o}),s.qZA(),s._UZ(4,"br"),s._UZ(5,"br"),s.TgZ(6,"button",26),s.NdJ("click",function(){return s.CHM(e),s.oxw(2).SetPassword()}),s._uU(7,"ACEPTAR"),s.qZA(),s.qZA()}if(2&e){const e=s.oxw(2);s.xp6(3),s.Q6J("ngModel",e.newPassword),s.xp6(3),s.Q6J("disabled",e.successUpdate)}}function C(e,o){if(1&e){const e=s.EpF();s.TgZ(0,"div",7),s.TgZ(1,"div",8),s.TgZ(2,"div",9),s.TgZ(3,"div",10),s.TgZ(4,"h2",11),s._uU(5,"Ingresa tu correo"),s.qZA(),s.TgZ(6,"form",12,13),s.NdJ("ngSubmit",function(){s.CHM(e);const o=s.MAs(7);return s.oxw().SendEmail(o.value)}),s.TgZ(8,"label",14),s._uU(9,"Correo electr\xf3nico"),s.qZA(),s.TgZ(10,"div",15),s._UZ(11,"input",16,17),s.YNc(13,x,3,2,"div",18),s.qZA(),s._UZ(14,"br"),s.YNc(15,A,2,1,"button",19),s.qZA(),s.YNc(16,P,11,2,"div",20),s.YNc(17,_,8,2,"div",20),s.qZA(),s.qZA(),s.qZA(),s.qZA()}if(2&e){const e=s.MAs(12),o=s.oxw();s.xp6(13),s.Q6J("ngIf",e.invalid&&(e.dirty||e.touched)),s.xp6(2),s.Q6J("ngIf",!o.procesandoEmail),s.xp6(1),s.Q6J("ngIf",1==o.tryPin),s.xp6(1),s.Q6J("ngIf",1==o.changuePass)}}function T(e,o){if(1&e&&(s.TgZ(0,"button",24),s._uU(1," CONTINUAR "),s.qZA()),2&e){const e=s.oxw(2);s.Q6J("disabled",!e.loginForm.valid)}}function q(e,o){if(1&e){const e=s.EpF();s.TgZ(0,"div",7),s.TgZ(1,"div",8),s.TgZ(2,"div",9),s.TgZ(3,"div",10),s.TgZ(4,"h2",11),s._uU(5,"Iniciar sesi\xf3n"),s.qZA(),s.TgZ(6,"form",28),s.NdJ("ngSubmit",function(){s.CHM(e);const o=s.oxw();return o.Login(o.loginForm.value)}),s.TgZ(7,"label",14),s._uU(8,"Correo electr\xf3nico"),s.qZA(),s.TgZ(9,"div",15),s._UZ(10,"input",29),s._UZ(11,"app-control-messages",30),s.qZA(),s.TgZ(12,"label",14),s._uU(13,"Contrase\xf1a"),s.qZA(),s.TgZ(14,"div",15),s._UZ(15,"input",31),s._UZ(16,"app-control-messages",30),s.qZA(),s._UZ(17,"br"),s.YNc(18,T,2,1,"button",19),s.qZA(),s._UZ(19,"br"),s.TgZ(20,"div"),s.TgZ(21,"a",32),s.NdJ("click",function(){return s.CHM(e),s.oxw().passwordForgotten=!0}),s._uU(22,"Olvid\xe9 mi contrase\xf1a"),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA()}if(2&e){const e=s.oxw();s.xp6(6),s.Q6J("formGroup",e.loginForm),s.xp6(5),s.Q6J("control",e.loginForm.get("email")),s.xp6(5),s.Q6J("control",e.loginForm.get("name")),s.xp6(2),s.Q6J("ngIf",!e.procesando)}}let I=(()=>{class e{constructor(e,o,t,n,r,s){if(this.toast=o,this.router=t,this.api=n,this.notiServ=r,this.pushService=s,this.environment=i.N,this.passwordForgotten=!1,this.procesando=!1,this.procesandoEmail=!1,this.email="",this.pin="",this.newPassword="",this.changuePass=!1,this.tryPin=!1,this.successUpdate=!1,localStorage.getItem("token")){let e=this.api.GetUser().role.name.toLowerCase();this.router.navigate([`/inicio/${e}/`])}this.loginForm=new a.cw({email:new a.NI("",a.kI.required),password:new a.NI("",a.kI.required)})}ngOnInit(){localStorage.getItem("cambio")&&localStorage.clear(),localStorage.getItem("creado")&&localStorage.clear()}Login(e){this.procesando=!0,this.api.Post("/Usuarios/login",e,!1).subscribe(e=>{localStorage.clear(),this.api.SetToken(e.id),this.api.Get("/Usuarios/withCredentials",!0).subscribe(e=>{this.procesando=!1,localStorage.setItem("user",JSON.stringify(e)),localStorage.setItem("ttl",r().add(1209600,"s").toISOString()),this.notiServ.LoadNotifications(),this.pushService.getUserID(),this.toast.ShowSuccess("Sesi\xf3n iniciada exitosamente");let o=this.api.GetUser().role.name.toLowerCase();this.router.navigate([`/inicio/${o}/`])},e=>{this.procesando=!1,this.toast.ShowError(e.error.error.message)})},e=>{this.procesando=!1,this.toast.ShowError(e.error.error.message)})}SendEmail(e){this.email=e.emailtoRecover,this.procesandoEmail=!0,this.api.Post("/PasswordResetPINs/createAndSend",{email:this.email},!1).subscribe(e=>{"notRegistered"==e.msg?(this.toast.ShowError("Usuario no registrado"),this.procesando=!1):(this.toast.ShowSuccess("Se envio el correo correctamente"),this.tryPin=!0)},e=>{this.toast.ShowError(e.err),this.procesando=!1,this.tryPin=!1})}TryPIN(){this.api.Post("/PasswordResetPINs/consume",{pin:this.pin,email:this.email},!1).subscribe(e=>{"Pin incorrecto"==e.msg?(this.toast.ShowError("PIN incorrecto"),this.pin=""):(this.toast.ShowSuccess("PIN correcto"),this.tryPin=!1,this.changuePass=!0)})}SetPassword(){this.api.Post("/PasswordResetPINs/resetPassword",{password:this.newPassword,email:this.email},!1).subscribe(e=>{"usuario actualizado"==e.msg?(this.toast.ShowSuccess("Contrase\xf1a asignada correctamente"),this.successUpdate=!0,this.passwordForgotten=!1,this.changuePass=!1,this.procesando=!1):this.toast.ShowSuccess("Sucedio un Error")})}}return e.\u0275fac=function(o){return new(o||e)(s.Y36(s.s_b),s.Y36(c.k),s.Y36(l.F0),s.Y36(d.sM),s.Y36(g.g),s.Y36(u._))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-login"]],decls:9,vars:5,consts:[[1,"loginBack"],[1,"row","justify-content-center","segment","title"],[1,"col-auto"],["src","assets/img/logo.png","alt","",1,"logo-img"],["class","lema",4,"ngIf"],["class","container",4,"ngIf"],[1,"lema"],[1,"container"],[1,"row"],[1,"col-12","col-lg-4"],[1,"circular","segment"],[1,"m-4"],[3,"ngSubmit"],["recoverPassword","ngForm"],[1,"colorPrincipal"],[1,"form-group"],["type","email","id","email","name","emailtoRecover","ngModel","","required","","pattern","[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,3}$",1,"form-control","text-center"],["emailtoRecover","ngModel"],["class","alert alert-danger",4,"ngIf"],["class","btn colorPrincipal fondo","type","submit",3,"disabled",4,"ngIf"],[4,"ngIf"],[1,"alert","alert-danger"],["class","form-control-feedback text-center",4,"ngIf"],[1,"form-control-feedback","text-center"],["type","submit",1,"btn","colorPrincipal","fondo",3,"disabled"],["type","number","name","pin",3,"ngModel","ngModelChange"],[1,"btn","colorPrincipal","fondo",3,"disabled","click"],["type","password","name","newPassword",1,"form-control-feedback","text-center",3,"ngModel","ngModelChange"],[3,"formGroup","ngSubmit"],["type","email","id","email","placeholder","ejemplo@email.com","name","email","required","","pattern","[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,3}$","formControlName","email",1,"form-control","text-center"],[3,"control"],["type","password","placeholder","Contrase\xf1a","name","password","required","","formControlName","password",1,"form-control","text-center"],[2,"color","orange",3,"click"]],template:function(e,o){1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"div",1),s.TgZ(2,"div",2),s._UZ(3,"img",3),s.YNc(4,f,2,0,"div",4),s.YNc(5,v,2,0,"div",4),s.YNc(6,Z,2,0,"div",4),s.qZA(),s.qZA(),s.YNc(7,C,18,4,"div",5),s.YNc(8,q,23,4,"div",5),s.qZA()),2&e&&(s.xp6(4),s.Q6J("ngIf",o.environment.production&&!o.environment.staging),s.xp6(1),s.Q6J("ngIf",!o.environment.production&&o.environment.staging),s.xp6(1),s.Q6J("ngIf",!o.environment.production&&!o.environment.staging),s.xp6(1),s.Q6J("ngIf",1==o.passwordForgotten),s.xp6(1),s.Q6J("ngIf",0==o.passwordForgotten))},directives:[n.O5,a._Y,a.JL,a.F,a.Fj,a.JJ,a.On,a.Q7,a.c5,a.wV,a.sg,a.u,h],styles:[".colorPrincipal[_ngcontent-%COMP%]{color:orange}.colorPrincipal.fondo[_ngcontent-%COMP%]{background-color:orange}.loader[_ngcontent-%COMP%]{border:10px solid #f3f3f3;border-top:10px orange;border-radius:50%;width:50px;height:50px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.loginBack[_ngcontent-%COMP%]{background-image:url(/assets/fondo/jarabe.jpg);background-color:orange!important;position:absolute;background-repeat:no-repeat;background-size:cover;width:100%;height:100%}.form-group[_ngcontent-%COMP%]{margin:5px auto;border-radius:10px}input[_ngcontent-%COMP%]{border-radius:10px!important}.circular.segment[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;background-color:hsla(0,0%,100%,.95)!important;display:table-cell;padding:2em;text-align:center;vertical-align:middle;border-radius:20px;width:500px;height:500px}.title.segment[_ngcontent-%COMP%]{margin-bottom:10px;padding:30px;background-color:hsla(0,0%,100%,.9)}.title[_ngcontent-%COMP%]{font-size:2em;text-align:center}.logo-img[_ngcontent-%COMP%]{height:100px}.lema[_ngcontent-%COMP%]{font-size:1em;text-align:center}.color.white[_ngcontent-%COMP%]{color:#fff}.row[_ngcontent-%COMP%]{margin:0;padding:0}"]}),e})(),N=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[n.ez]]}),e})();const S=[{path:"",component:I}];let U=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[n.ez,a.u5,a.UX,l.Bz.forChild(S),N]]}),e})()}}]);