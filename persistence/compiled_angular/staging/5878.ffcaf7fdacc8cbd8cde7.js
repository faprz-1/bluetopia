(self.webpackChunktemplate_web=self.webpackChunktemplate_web||[]).push([[5878],{7764:(e,t,n)=>{"use strict";n.d(t,{l:()=>d});var i=n(7368),o=n(1116);function s(e,t){if(1&e&&(i.TgZ(0,"span"),i._uU(1),i.qZA()),2&e){const e=t.$implicit,n=t.last;i.xp6(1),i.Oqu(e.name+(n?"":","))}}function r(e,t){if(1&e&&(i.TgZ(0,"span",13),i._uU(1),i.qZA()),2&e){const e=t.$implicit,n=t.last;i.xp6(1),i.Oqu((null==e.grade?null:e.grade.name)+(null==e.group?null:e.group.name)+(n?"":","))}}function a(e,t){if(1&e&&(i.TgZ(0,"div",3),i.TgZ(1,"div",4),i._UZ(2,"i",11),i.qZA(),i.TgZ(3,"div",6),i.YNc(4,r,2,1,"span",12),i.qZA(),i.qZA()),2&e){const e=i.oxw();i.xp6(4),i.Q6J("ngForOf",null==e.teacher?null:e.teacher.teacherGroups)}}let d=(()=>{class e{constructor(){this.teacher=null,this.showGroups=!1,this.onDelete=new i.vpe}ngOnInit(){}OnDeletedPressed(e){e.stopPropagation(),this.onDelete.emit(this.teacher)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Xpm({type:e,selectors:[["app-teacher-card"]],inputs:{teacher:"teacher",showGroups:"showGroups"},outputs:{onDelete:"onDelete"},decls:21,vars:4,consts:[[1,"card","position-relative"],[1,"delete","clickeable",3,"click"],[1,"card-body"],[1,"text-row"],[1,"img-container"],["src","assets/icons/user-green.png","alt","user"],[1,"text-row-data"],["src","assets/icons/mail-green.png","alt","mail"],["src","assets/icons/book-green.png","alt","book"],[4,"ngFor","ngForOf"],["class","text-row",4,"ngIf"],[1,"zmdi","zmdi-accounts-outline"],["class","text-uppercase",4,"ngFor","ngForOf"],[1,"text-uppercase"]],template:function(e,t){1&e&&(i.TgZ(0,"div",0),i.TgZ(1,"span",1),i.NdJ("click",function(e){return t.OnDeletedPressed(e)}),i._uU(2," \xd7 "),i.qZA(),i.TgZ(3,"div",2),i.TgZ(4,"div",3),i.TgZ(5,"div",4),i._UZ(6,"img",5),i.qZA(),i.TgZ(7,"div",6),i.TgZ(8,"span"),i._uU(9),i.qZA(),i.qZA(),i.qZA(),i.TgZ(10,"div",3),i.TgZ(11,"div",4),i._UZ(12,"img",7),i.qZA(),i.TgZ(13,"div",6),i._uU(14),i.qZA(),i.qZA(),i.TgZ(15,"div",3),i.TgZ(16,"div",4),i._UZ(17,"img",8),i.qZA(),i.TgZ(18,"div",6),i.YNc(19,s,2,1,"span",9),i.qZA(),i.qZA(),i.YNc(20,a,5,1,"div",10),i.qZA(),i.qZA()),2&e&&(i.xp6(9),i.Oqu(null==t.teacher?null:t.teacher.name),i.xp6(5),i.hij(" ",null==t.teacher?null:t.teacher.email," "),i.xp6(5),i.Q6J("ngForOf",null==t.teacher?null:t.teacher.subjects),i.xp6(1),i.Q6J("ngIf",t.showGroups))},directives:[o.sg,o.O5],styles:[".card[_ngcontent-%COMP%]{padding:1.2rem 4rem;border:2px solid #2ed2a3;border-radius:12px;color:#758ca6;font-size:1.5rem;font-weight:500;width:-webkit-max-content;width:max-content;max-width:100%;margin-bottom:0}.card-body[_ngcontent-%COMP%]{padding:0;display:flex;flex-direction:column;justify-content:space-between}.text-row[_ngcontent-%COMP%]{display:flex;align-items:center;min-height:30px;margin-bottom:10px}.text-row[_ngcontent-%COMP%]   .text-row-data[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:start;flex-grow:1;flex-wrap:wrap;line-height:30px}.text-row[_ngcontent-%COMP%]   .text-row-data[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:.3rem}.text-row[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]{display:flex;align-items:center;height:-webkit-min-content;height:min-content;padding-right:12px;text-align:left}.text-row[_ngcontent-%COMP%]   .img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:-webkit-max-content;width:max-content;height:-webkit-max-content;height:max-content}.delete[_ngcontent-%COMP%]{font-size:2rem;position:absolute;top:10px;right:15px;color:var(--danger)}.zmdi[_ngcontent-%COMP%]{color:#2ed2a3}"]}),e})()},8838:(e,t,n)=>{"use strict";n.d(t,{b:()=>a});var i=n(1116),o=n(1041),s=n(6050),r=(n(7764),n(7368));let a=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[o.u5,i.ez,o.UX,s.G]]}),e})()},5878:(e,t,n)=>{"use strict";n.r(t),n.d(t,{StudentsDataModule:()=>P});var i=n(1116),o=n(2894),s=n(4391),r=n(1041),a=n(6050),d=n(8838),l=n(5470),c=n(7368),g=n(407),u=n(1392),p=n(6189),h=n(2722),m=n(1148);const Z=["addGradeOrGroupModal"];function f(e,t){1&e&&c._UZ(0,"div")}function x(e,t){if(1&e&&(c.TgZ(0,"div"),c._uU(1),c.qZA()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.hij(" ",e.registerNumber," ")}}function v(e,t){1&e&&c._UZ(0,"div")}function A(e,t){if(1&e&&(c.TgZ(0,"div"),c._uU(1),c.qZA()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.hij(" ",e.name," ")}}function T(e,t){1&e&&c._UZ(0,"div")}function b(e,t){if(1&e&&(c.TgZ(0,"div"),c._uU(1),c.qZA()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.hij(" ",e.fullName," ")}}function q(e,t){1&e&&c._UZ(0,"div")}function w(e,t){1&e&&(c.TgZ(0,"div"),c._uU(1," 4.5 "),c.qZA())}function _(e,t){1&e&&c._UZ(0,"div")}function O(e,t){1&e&&(c.TgZ(0,"div"),c._uU(1," 4.5 "),c.qZA())}function S(e,t){1&e&&c._UZ(0,"div")}function G(e,t){1&e&&c._UZ(0,"div",42)}function y(e,t){if(1&e&&(c.TgZ(0,"tr"),c.TgZ(1,"td"),c.YNc(2,f,1,0,"div",40),c.YNc(3,x,2,1,"div",40),c.qZA(),c.TgZ(4,"td"),c.YNc(5,v,1,0,"div",40),c.YNc(6,A,2,1,"div",40),c.qZA(),c.TgZ(7,"td"),c.YNc(8,T,1,0,"div",40),c.YNc(9,b,2,1,"div",40),c.qZA(),c.TgZ(10,"td"),c.YNc(11,q,1,0,"div",40),c.YNc(12,w,2,0,"div",40),c.qZA(),c.TgZ(13,"td"),c.YNc(14,_,1,0,"div",40),c.YNc(15,O,2,0,"div",40),c.qZA(),c.TgZ(16,"td"),c.YNc(17,S,1,0,"div",40),c.YNc(18,G,1,0,"div",41),c.qZA(),c.qZA()),2&e){const e=c.oxw(2);c.xp6(2),c.Q6J("ngIf",e.isEditing),c.xp6(1),c.Q6J("ngIf",!e.isEditing),c.xp6(2),c.Q6J("ngIf",e.isEditing),c.xp6(1),c.Q6J("ngIf",!e.isEditing),c.xp6(2),c.Q6J("ngIf",e.isEditing),c.xp6(1),c.Q6J("ngIf",!e.isEditing),c.xp6(2),c.Q6J("ngIf",e.isEditing),c.xp6(1),c.Q6J("ngIf",!e.isEditing),c.xp6(2),c.Q6J("ngIf",e.isEditing),c.xp6(1),c.Q6J("ngIf",!e.isEditing),c.xp6(2),c.Q6J("ngIf",e.isEditing),c.xp6(1),c.Q6J("ngIf",!e.isEditing)}}function U(e,t){if(1&e&&(c.TgZ(0,"tbody"),c.YNc(1,y,19,12,"tr",39),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngForOf",e.students)}}function M(e,t){1&e&&(c.TgZ(0,"tbody"),c.TgZ(1,"tr"),c.TgZ(2,"td",43),c._UZ(3,"i",44),c.qZA(),c.qZA(),c.qZA())}const C=function(){return{backdrop:"static",keyboard:!1}},N=[{path:"",component:(()=>{class e{constructor(e,t,n,i,o){this.nav=e,this.api=t,this.toast=n,this.downloadFile=i,this.csvService=o,this.user=null,this.grades=[],this.groups=[],this.gradeSelected=null,this.groupSelected=null,this.students=[],this.isEditing=!1,this.loading={getting:!1,creating:!1},this.dataConversions=[{oldKey:"Nombre",newKey:"name"},{oldKey:"Apellido P",newKey:"fatherLastname"},{oldKey:"Apellido M",newKey:"motherLastname"},{oldKey:"Numero de registro",newKey:"registerNumber"},{oldKey:"Grado",newKey:"grade"},{oldKey:"Grupo",newKey:"group"}],this.studentsToUpload=[],this.areStudentsValid=!0}ngOnInit(){this.user=this.api.GetUser(),this.GetTeacherGroups(),this.SetGroupsOfSelectedGrade(this.gradeSelected)}GetTeacherGroups(){var e;let t=this.api.GetUser();this.api.Get(`/TeacherGroups/of/${null===(e=t.teacher)||void 0===e?void 0:e.id}`).subscribe(e=>{this.SetGrades(e)},e=>{console.error("Error getting groups",e)})}SetGrades(e){this.grades=[],this.GroupByProperty(e,"gradeId").forEach(e=>{let t=e[0].grade;t.groups=e.map(e=>e.group),this.grades.push(t)}),this.grades=this.SortbyName(this.grades)}GroupByProperty(e,t){return Object.values(e.reduce((e,n)=>{const i=n[t];return e[i]||(e[i]=[]),e[i].push(n),e},{}))}SetGroupsOfSelectedGrade(e){if(this.groups=[],e&&null!=e&&0!=e){let t=this.grades.filter(t=>t.id==e);this.groups=t.length>0?t[0].groups:[]}else this.groups=[];this.groups=this.SortbyName(this.groups)}SortbyName(e){return e.sort((e,t)=>{const n=e.name.toLowerCase(),i=t.name.toLowerCase();return n.localeCompare(i)})}GetStudents(){if(this.SetGroupsOfSelectedGrade(this.gradeSelected.id),!this.gradeSelected||!this.groupSelected)return this.students=[],void(this.loading.getting=!1);this.loading.getting=!0;let e="/Students";switch(this.user.role.name){case"School":e+=`/OfSchool/${this.user.id}`;break;case"Teacher":e+=`/OfTeacher/${this.user.id}`;break;default:e+="/OfSchool"}e+=`/FilteredBy/Grade/${this.gradeSelected?this.gradeSelected.id:0}/Group/${this.groupSelected?this.groupSelected.id:0}`,this.api.Get(e).subscribe(e=>{this.students=this.SortInAlphabeticalOrder(e),this.loading.getting=!1},e=>{console.error("Error getting students",e),this.loading.getting=!1})}SortInAlphabeticalOrder(e){return e.map(e=>Object.assign(Object.assign({},e),{fullName:`${e.fatherLastname} ${e.motherLastname}`})).sort((e,t)=>e.fullName.localeCompare(t.fullName))}AddGradeOrGroup(){this.loading.creating=!0,this.api.Post("/Grades/GradeOrGroup",{}).subscribe(e=>{var t;this.toast.ShowSuccess("Datos agregados"),null===(t=this.addGradeOrGroupModal)||void 0===t||t.hide(),this.loading.creating=!1},e=>{console.error("Error creating grade or group",e),this.loading.creating=!1})}DownloadTemplate(){this.downloadFile.DownloadWithoutApi("assets/docs/studentsTemplate.csv","studentsTemplate.csv")}OnFileChanged(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{this.csvService.ReadCSV(n.result).then(e=>{this.studentsToUpload=this.FormatData(e.data),this.areStudentsValid=this.ValidateStudents(this.studentsToUpload)})},t&&n.readAsText(t,"ISO-8859-3")}FormatData(e){const t=this.api.GetUser();return e.map(e=>{let n={};return this.dataConversions.forEach(t=>{n[t.newKey]=e[t.oldKey]}),n.schoolId=t.schoolId,n.teacherUserId=t.id,n})}UploadStudents(){this.loading.uploading=!0,this.api.Post("/Students/Array",{students:this.studentsToUpload}).subscribe(e=>{var t;this.toast.ShowSuccess(`${e.length} Estudiantes agregados correctamente`),null===(t=this.addGradeOrGroupModal)||void 0===t||t.hide(),this.loading.uploading=!1},e=>{this.toast.ShowError("Error al subir a los estudiantes"),console.error("Error at uploading students",e),this.loading.uploading=!1})}ValidateStudents(e){let t=!0,n=["name","fatherLastname","motherLastname","registerNumber"],i=new Map;return e.forEach(e=>{e.name||(t=!1,i.set(n[0],{required:!0,message:"Algunos estudiantes no tienen nombre"})),e.fatherLastname||i.set(n[0],{required:!1,message:"Algunos estudiantes no tienen apellido paterno"}),e.motherLastname||i.set(n[2],{required:!1,message:"Algunos estudiantes no tienen apellido materno"}),e.registerNumber||(t=!1,i.set(n[3],{required:!0,message:"Algunos estudiantes no tienen n\xfamero de registro"}))}),i.forEach(e=>{e.required?this.toast.ShowError(e.message):this.toast.ShowWarning(e.message)}),t}GoToStudentsCSVPage(){this.nav.GoToUserRoute("registrar-estudiantes/csv")}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(g.f),c.Y36(u.sM),c.Y36(p.k),c.Y36(h.p),c.Y36(m.m))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-students-data"]],viewQuery:function(e,t){if(1&e&&c.Gf(Z,5),2&e){let e;c.iGM(e=c.CRH())&&(t.addGradeOrGroupModal=e.first)}},decls:68,vars:10,consts:[[1,"content"],[1,"row","mb-5"],[1,"col-12","d-flex","h-100","align-items-center","justify-content-between"],[1,"page-title","text-success"],[1,"btn","btn-outline-success",3,"click"],[1,"row"],[1,"col-12","d-flex","align-items-center","filters"],[1,"flex-grow-1","filter"],[1,"input-container"],[1,"input-icon-container","icon-container-right","text-center"],["src","assets/icons/search-small.png"],["type","text","placeholder","Buscar",1,"form-control","icon-right"],[1,"select-container","filter"],["bindLabel","name","placeholder","Grado",1,"ng-select","form-control",3,"items","ngModel","change","ngModelChange"],["bindLabel","name","placeholder","Grupo",1,"ng-select","form-control",3,"items","ngModel","change","ngModelChange"],[1,"col-12","mt-5"],[1,"table"],[4,"ngIf","ngIfElse"],["bigLoading",""],["bsModal","","tabindex","-1","role","dialog","aria-labelledby","addGradeOrGroupModal",1,"modal","fade",3,"config"],["addGradeOrGroupModal","bs-modal"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header","p-0"],["src","assets/icons/close.svg","alt","close",1,"close",3,"click"],[1,"modal-body","text-center"],[1,"inner-content"],[1,"modal-title-2"],[1,"modal-text"],["src","assets/icons/excel.png","alt","CSV file",1,"mr-3"],[1,"link",3,"click"],["type","file","accept",".csv",1,"d-none",3,"change"],["studentsCsv",""],[1,"w-100","d-flex","flex-column","align-items-center"],[1,"upload-container","clickeable",3,"click"],["src","assets/icons/upload.png","alt","CSV file"],[1,"modal-text","mt-3"],[1,"modal-footer","justify-content-center"],[1,"btn","btn-primary","modal-btn",3,"disabled","click"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","d-flex align-items-center justify-content-center",4,"ngIf"],[1,"d-flex","align-items-center","justify-content-center"],["colspan","6",1,"text-center"],[1,"zmdi","zmdi-spinner","zmdi-hc-5x","zmdi-hc-spin"]],template:function(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c.TgZ(3,"div",3),c._uU(4," Datos de alumnos "),c.qZA(),c.TgZ(5,"button",4),c.NdJ("click",function(){return t.GoToStudentsCSVPage()}),c._uU(6," Agregar grado o grupo "),c.qZA(),c.qZA(),c.qZA(),c.TgZ(7,"div",5),c.TgZ(8,"div",6),c.TgZ(9,"div",7),c.TgZ(10,"div",8),c.TgZ(11,"div",9),c._UZ(12,"img",10),c.qZA(),c._UZ(13,"input",11),c.qZA(),c.qZA(),c.TgZ(14,"div",12),c.TgZ(15,"ng-select",13),c.NdJ("change",function(){return t.GetStudents()})("ngModelChange",function(e){return t.gradeSelected=e}),c.qZA(),c.qZA(),c.TgZ(16,"div",12),c.TgZ(17,"ng-select",14),c.NdJ("change",function(){return t.GetStudents()})("ngModelChange",function(e){return t.groupSelected=e}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(18,"div",15),c.TgZ(19,"table",16),c.TgZ(20,"thead"),c.TgZ(21,"tr"),c.TgZ(22,"th"),c._uU(23,"#"),c.qZA(),c.TgZ(24,"th"),c._uU(25,"Nombre"),c.qZA(),c.TgZ(26,"th"),c._uU(27,"Apellidos"),c.qZA(),c.TgZ(28,"th"),c._uU(29,"Materias"),c.qZA(),c.TgZ(30,"th"),c._uU(31,"Promedio"),c.qZA(),c.TgZ(32,"th"),c._uU(33,"Acci\xf3nes"),c.qZA(),c.qZA(),c.qZA(),c.YNc(34,U,2,1,"tbody",17),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.YNc(35,M,4,0,"ng-template",null,18,c.W1O),c.TgZ(37,"div",19,20),c.TgZ(39,"div",21),c.TgZ(40,"div",22),c.TgZ(41,"div",23),c.TgZ(42,"img",24),c.NdJ("click",function(){return c.CHM(e),c.MAs(38).hide()}),c.qZA(),c.qZA(),c.TgZ(43,"div",25),c.TgZ(44,"div",26),c.TgZ(45,"div",27),c._uU(46,"Agrega un grupo"),c.qZA(),c.TgZ(47,"div",28),c._uU(48," 1) Descarga la plantilla "),c.qZA(),c.TgZ(49,"div"),c._UZ(50,"img",29),c.TgZ(51,"a",30),c.NdJ("click",function(){return t.DownloadTemplate()}),c._uU(52,"Descargar"),c.qZA(),c.qZA(),c.TgZ(53,"div",28),c._uU(54," 2) Llena la plantilla "),c.qZA(),c.TgZ(55,"div",28),c._uU(56," 3) Sube la plantilla con los datos de tus alumnos "),c.qZA(),c.TgZ(57,"input",31,32),c.NdJ("change",function(e){return t.OnFileChanged(e)}),c.qZA(),c.TgZ(59,"div",33),c.TgZ(60,"div",34),c.NdJ("click",function(){return c.CHM(e),c.MAs(58).click()}),c._UZ(61,"img",35),c._uU(62," Subir excel de alumnos "),c.qZA(),c.TgZ(63,"div",36),c._uU(64),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(65,"div",37),c.TgZ(66,"button",38),c.NdJ("click",function(){return t.UploadStudents()}),c._uU(67," Guardar "),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=c.MAs(36),n=c.MAs(58);let i;c.xp6(15),c.Q6J("items",t.grades)("ngModel",t.gradeSelected),c.xp6(2),c.Q6J("items",t.groups)("ngModel",t.groupSelected),c.xp6(17),c.Q6J("ngIf",!t.loading.getting)("ngIfElse",e),c.xp6(3),c.Q6J("config",c.DdM(9,C)),c.xp6(27),c.hij(" ",null==n.files||null==(i=n.files.item(0))?null:i.name," "),c.xp6(2),c.Q6J("disabled",t.loading.creating)}},directives:[s.w9,r.JJ,r.On,i.O5,l.oB,i.sg],styles:[".inner-content[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column;align-items:flex-start;padding:23px 24px;grid-gap:40px;gap:40px}.modal-title-2[_ngcontent-%COMP%]{color:var(--blue-1,#1081fb)}.modal-text[_ngcontent-%COMP%], .modal-title-2[_ngcontent-%COMP%]{font-size:20px;font-family:Mulish;font-weight:700}.modal-text[_ngcontent-%COMP%]{color:var(--gray-1,#3d5e81)}.upload-container[_ngcontent-%COMP%]{display:inline-block;font-size:1rem;font-weight:500;color:#1081fb;padding:23px;border:3px dashed #1081fb;border-radius:20px}.upload-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-right:15px}.link[_ngcontent-%COMP%]{color:#2ed2a3}.modal-btn[_ngcontent-%COMP%]{width:510px;max-width:100%}"]}),e})()}];let P=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[r.u5,i.ez,s.A0,d.b,r.UX,a.G,l.zk.forRoot(),o.Bz.forChild(N)]]}),e})()}}]);